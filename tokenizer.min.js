(function(d){var c="tokenizer";var b=function(g,e){var p,u,o,q,h=d.extend({xContent:"&times;",namespace:"tknz",label:"Tags:",placeholder:"",separators:[","," ","."],callback:null,source:null,allowUnknownTags:true,numToSuggest:5,onclick:null},e);var s,x,f,k,l,v,n,w,j,m,t,r,i;s=function(){p=g;x();f()};x=function(){var y=h.namespace;u=d('<div class="'+y+'-list"></div>');if(h.placeholder){p.attr("placeholder",h.placeholder)}q=d('<div class="'+y+'-suggest"><ul></ul></div>');o=p.addClass(y+"-input").wrap('<span class="'+y+'-input-wrapper"></span>').parent().wrap('<div class="'+y+'-wrapper"></div>').parent().prepend(u).prepend('<span class="'+y+'-wrapper-label">'+h.label+"</span>").find("."+y+"-input-wrapper").append(q).end()};f=function(){var y=h.namespace;o.on("focus","input",function(){o.addClass(y+"-focus")}).on("blur","input",function(){o.removeClass(y+"-focus");r(p.val())}).on("keydown","input",function(){if(event.which===8&&!p.val()){l();j();return}var A=y+"-sel",z=q.find("."+A);if(event.which===38){event.preventDefault();if(z.length){z.removeClass(A).prev("li").add(z.siblings().last()).eq(0).addClass(A)}else{q.find("li").last().addClass(A)}}else{if(event.which===40){event.preventDefault();if(z.length){z.removeClass(A).next("li").addClass(A)}else{q.find("li").first().addClass(A)}}}}).on("keypress","input",function(z){if(h.separators.indexOf(String.fromCharCode(z.which))>-1||z.which===13){z.preventDefault();r(p.val())}}).on("keyup","input",function(z){if(z.which===38||z.which===40){return}if(d.isArray(h.source)){m(h.source)}else{if(h.source){h.source(p.val(),m)}}}).on("click",function(){p.focus()}).on("click","."+y+"-token-x",function(z){z.stopPropagation();d(this).closest("."+y+"-token").remove();j()}).on("click","."+y+"-suggest-li",function(){p.val("");k(d(this).text());m([]);j()}).on("click","."+y+"-token",function(z){if(h.onclick){z.stopPropagation();h.onclick(d(this).children("."+y+"-token-label").text())}})};r=function(z){var y=t();if(z&&(h.allowUnknownTags||y)){k(y||z);p.val("");j()}m([],"")};k=function(A){var z=h.namespace,B=z+"-token",y='<div class="'+B+'" data-token="'+A+'"><span class="'+B+'-label">'+A.trim()+'</span><span class="'+B+'-x">'+h.xContent+"</span></div>";u.append(y);return p};l=function(){return u.children().last().detach().data("token")||null};n=function(){u.empty();return p};v=function(){var y,A=[],z=u.children();for(y=0;y<z.length;y++){A.push(z.eq(y).data("token").toString())}return A};w=function(){o.after(p).remove();if(h.placeholder){p.attr("placeholder","")}return p.removeClass(h.namespace+"-input")};j=function(){(h.callback||d.noop)(p);return p};m=function(F,E){E=E===undefined?p.val():E;var B,C=h.namespace,A=new RegExp(i(E),"i"),z=new RegExp("^"+i(E)+"$","i"),y=h.numToSuggest||1000,D=[];for(B=0;E&&B<F.length&&D.length<y;B++){if(!F[B].match(A)){continue}D.push('<li class="'+C+"-suggest-li"+(F[B].match(z)?" "+C+"-sel":"")+'">'+F[B]+"</li>")}q.children("ul").html(D.join("")).end()[D.length?"addClass":"removeClass"]("."+C+"-vis")};t=function(){return q.find("."+h.namespace+"-sel").eq(0).text()};i=function(y){return y.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")};s(g);return{push:k,pop:l,empty:n,get:v,destroy:w,callback:j}};var a={init:function(e){if(this[0].nodeName!=="INPUT"){d.error('Tokenizer requires an <input type="text"> tag.');return this}return this.data(c,b(this,e))},push:function(e){return this.data(c).push(e)},pop:function(){return this.data(c).pop()},empty:function(){return this.data(c).empty()},get:function(){return this.data(c).get()},destroy:function(){return this.data(c).destroy()},callback:function(){return this.data(c).callback()}};d.fn[c]=function(e){if(a[e]){if(!this.data(c)){d.error('Cannot call "'+e+'" - Tokenizer not initialized.')}return a[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return a.init.apply(this,arguments)}else{d.error("Unknown tokenizer method "+e+".")}}}})(jQuery);